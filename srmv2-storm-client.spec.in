%define name         srmv2-storm-client
%define version      @VERSION@
%define release      @STORMPATCHLVL@
%define flavor       @GLOBUS_FLAVOR@
%define builddir     $RPM_BUILD_DIR/%{name}-%{flavor}-%{version}
%define globusdir    @GLOBUS_LOCATION@
%define gsoapdir     @GSOAP_DIR@
%define gsoapgsidir  @GSOAPGSI_DIR@
%define mysqldir     @MYSQL_DIR@
%define xmlrpccdir   @XMLRPC_C_DIR@
%define prefix       @PREFIX@

Name:           %{name}-%{flavor}
Version:        %{version}
Release:        %{release}
Vendor:         INFN FIRB Grid.It Project (2004)
Packager:       storm@infn.it
Copyright:      INFN License
URL:            http://grid-it.cnaf.infn.it
Source:         @PACKAGE@-%{version}.tar.gz
Group:          Application/Generic
AutoReqProv:    no
Requires:       CGSI_gSOAP_2.6 >= 1.1.9
BuildRoot:      /var/tmp/%{name}-%{flavor}-%{version}
Prefix:         %{prefix}
Summary:        Provides the the srmv2 storm test clients. 
%description
This is the installation bundle for the srmv2 storm test clients.
This bundle is part of the StoRM utility 
package that implements an SRM interface to a GPFS parallel
filesystem.

%prep
%setup -n @PACKAGE@-%{version} 

%build
source frontend-setup.sh
./autogen.sh
./configure --prefix=%{prefix} --disable-all --enable-fe-client --enable-gsoapgsi --with-globus-location=%{globusdir} --with-globus-flavor=%{flavor} --with-gsoap-dir=%{gsoapdir} --with-gsoapgsi-dir=%{gsoapgsidir} --with-mysql-dir=%{mysqldir} --with-xmlrpc-c-dir=%{xmlrpccdir}

gmake

%install
if [ -d $RPM_BUILD_ROOT ]; then rm -rf $RPM_BUILD_ROOT; fi
mkdir -p $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT
# Build the file-list automatically :)
cd $RPM_BUILD_ROOT
find . -type d | sed '1,3d;s,^\.,\%attr(-\,root\,root) \%dir ,' > $RPM_BUILD_DIR/file.list.%{name}
find . -type f | sed 's,^\.,\%attr(-\,root\,root) ,' >> $RPM_BUILD_DIR/file.list.%{name}
find . -type l | sed 's,^\.,\%attr(-\,root\,root) ,' >> $RPM_BUILD_DIR/file.list.%{name}

%clean
rm -rf $RPM_BUILD_ROOT
rm ../file.list.%{name}

%files -f ../file.list.%{name}

